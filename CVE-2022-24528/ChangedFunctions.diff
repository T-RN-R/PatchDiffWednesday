@@ -140007,84 +140326,96 @@ long __thiscall GetBufferDo(OSF_CCALL *this,uint param_1,void **param_2)
 long __thiscall GetCoalescedBuffer(OSF_CCALL *this,_RPC_MESSAGE *param_1)
 
 {
-  OSF_CCALL *pOVar1;
-  long lVar2;
-  void *pvVar3;
-  OSF_CCALL *this_00;
-  BCACHE *this_01;
-  uint uVar4;
-  int iVar5;
-  ulonglong uVar6;
+  MUTEX *this_00;
+  long lVar1;
+  void *pvVar2;
+  MUTEX *this_01;
+  BCACHE *this_02;
+  uint uVar3;
+  int iVar4;
+  ulonglong uVar5;
+  BCACHE *pBVar6;
   BCACHE *pBVar7;
-  int iVar8;
-  BCACHE *pBVar9;
+  uint uVar8;
   uint local_res8;
   undefined4 uStackX12;
   int local_res10;
   
-  pOVar1 = this + 0x1d0;
+  this_00 = (MUTEX *)(this + 0x1d0);
   local_res10 = 0;
-  uVar4 = *(uint *)(param_1 + 0x48) & 0x4000;
-  this_00 = pOVar1;
+  uVar3 = *(uint *)(param_1 + 0x48) & 0x4000;
+  this_01 = this_00;
   RtlEnterCriticalSection();
-  iVar8 = *(int *)(this + 0x150);
-  if (iVar8 == 0) {
-    RtlLeaveCriticalSection(pOVar1);
-    if (uVar4 == 0) {
-      pvVar3 = TakeOffQueue((QUEUE *)(this + 0x210),(uint *)&local_res8);
+  uVar8 = *(uint *)(this + 0x150);
+  if (uVar8 == 0) {
+    Clear(this_00);
+    if (uVar3 == 0) {
+      pvVar2 = TakeOffQueue((QUEUE *)(this + 0x210),(uint *)&local_res8);
       *(undefined4 *)(param_1 + 0x18) = 0;
       *(uint *)(param_1 + 0x48) = *(uint *)(param_1 + 0x48) | 0x1000;
-      *(void **)(param_1 + 0x10) = pvVar3;
+      *(void **)(param_1 + 0x10) = pvVar2;
       *(int *)(this + 0x200) = *(int *)(this + 0x200) + -1;
     }
+LAB_1800a8ea7:
+    lVar1 = 0;
   }
   else {
-    if (uVar4 != 0) {
-      iVar8 = iVar8 + *(int *)(param_1 + 0x18);
-    }
-    lVar2 = TransGetBuffer((OSF_SCONNECTION *)this_00,(void **)&local_res8,iVar8 + 0x18);
-    if (lVar2 != 0) {
-      RtlLeaveCriticalSection(pOVar1);
-      return 0xe;
-    }
-    pBVar7 = (BCACHE *)(CONCAT44(uStackX12,local_res8) + 0x18);
-    pBVar9 = pBVar7;
-    if (uVar4 == 0) goto LAB_1800a8e6a;
-    if (*(longlong *)(param_1 + 0x10) == 0) goto LAB_1800a8e6a;
-    this_01 = pBVar7;
-    memcpy(pBVar7,*(longlong *)(param_1 + 0x10),(ulonglong)*(uint *)(param_1 + 0x18));
-    pvVar3 = *(void **)(param_1 + 0x10);
-    pBVar9 = pBVar7 + *(uint *)(param_1 + 0x18);
-    while( true ) {
-      if ((void *)((longlong)pvVar3 + -0x18) != (void *)0x0) {
-        Free(this_01,(void *)((longlong)pvVar3 + -0x18));
+    if (uVar3 == 0) {
+LAB_1800a8d8e:
+      lVar1 = TransGetBuffer((OSF_SCONNECTION *)this_01,(void **)&local_res8,uVar8 + 0x18);
+      if (lVar1 == 0) {
+        pBVar7 = (BCACHE *)(CONCAT44(uStackX12,local_res8) + 0x18);
+        pBVar6 = pBVar7;
+        if ((uVar3 != 0) && (*(longlong *)(param_1 + 0x10) != 0)) {
+          this_02 = pBVar7;
+          memcpy(pBVar7,*(longlong *)(param_1 + 0x10),(ulonglong)*(uint *)(param_1 + 0x18));
+          uVar3 = *(uint *)(param_1 + 0x18);
+          pBVar6 = pBVar7 + uVar3;
+          if ((void *)(*(longlong *)(param_1 + 0x10) + -0x18) != (void *)0x0) {
+            Free(this_02,(void *)(*(longlong *)(param_1 + 0x10) + -0x18));
+          }
+        }
+        pvVar2 = TakeOffQueue((QUEUE *)(this + 0x210),(uint *)&local_res8);
+        while (pvVar2 != (void *)0x0) {
+          uVar5 = (ulonglong)local_res8;
+          this_02 = pBVar6;
+          memcpy(pBVar6,pvVar2,(ulonglong)local_res8);
+          pBVar6 = pBVar6 + uVar5;
+          if ((void *)((longlong)pvVar2 + -0x18) != (void *)0x0) {
+            Free(this_02,(void *)((longlong)pvVar2 + -0x18));
+          }
+          pvVar2 = TakeOffQueue((QUEUE *)(this + 0x210),(uint *)&local_res8);
+        }
+        iVar4 = local_res10;
+        if (*(int *)(this + 0x1c4) != 0) {
+          *(undefined4 *)(this + 0x1c4) = 0;
+          iVar4 = 1;
+        }
+        *(BCACHE **)(param_1 + 0x10) = pBVar7;
+        *(uint *)(param_1 + 0x18) = uVar8;
+        if ((*(int *)(this + 0x108) - 10U & 0xfffffffd) == 0) {
+          *(uint *)(param_1 + 0x48) = *(uint *)(param_1 + 0x48) | 0x1000;
+          *(int *)(this + 0x200) = *(int *)(this + 0x200) + -1;
+        }
+        *(undefined4 *)(this + 0x150) = 0;
+        Clear((MUTEX *)(this + 0x1d0));
+        if (iVar4 != 0) {
+          TransAsyncReceive(*(OSF_CCONNECTION **)(this + 0x110));
+        }
+        goto LAB_1800a8ea7;
       }
-LAB_1800a8e6a:
-      pvVar3 = TakeOffQueue((QUEUE *)(this + 0x210),(uint *)&local_res8);
-      if (pvVar3 == (void *)0x0) break;
-      uVar6 = (ulonglong)local_res8;
-      this_01 = pBVar9;
-      memcpy(pBVar9,pvVar3,(ulonglong)local_res8);
-      pBVar9 = pBVar9 + uVar6;
-    }
-    iVar5 = local_res10;
-    if (*(int *)(this + 0x1c4) != 0) {
-      *(undefined4 *)(this + 0x1c4) = 0;
-      iVar5 = 1;
-    }
-    *(BCACHE **)(param_1 + 0x10) = pBVar7;
-    *(int *)(param_1 + 0x18) = iVar8;
-    if ((*(int *)(this + 0x108) - 10U & 0xfffffffd) == 0) {
-      *(uint *)(param_1 + 0x48) = *(uint *)(param_1 + 0x48) | 0x1000;
-      *(int *)(this + 0x200) = *(int *)(this + 0x200) + -1;
+      lVar1 = 0xe;
     }
-    *(undefined4 *)(this + 0x150) = 0;
-    RtlLeaveCriticalSection(this + 0x1d0);
-    if (iVar5 != 0) {
-      TransAsyncReceive(*(OSF_CCONNECTION **)(this + 0x110));
+    else {
+      this_01 = (MUTEX *)(ulonglong)uVar8;
+      lVar1 = UIntAdd(uVar8,*(uint *)(param_1 + 0x18),(uint *)&local_res8);
+      uVar8 = local_res8;
+      if (-1 < lVar1) goto LAB_1800a8d8e;
+      lVar1 = 0x6c6;
     }
+    Clear(this_00);
   }
-  return 0;
+  return lVar1;
 }
 @@ -144232,73 +144593,78 @@ long __thiscall GetCoalescedBuffer(OSF_SCALL *this,_RPC_MESSAGE *param_1,int par
 
 {
   uint uVar1;
-  long lVar2;
-  void *pvVar3;
-  OSF_SCALL *this_00;
-  uint uVar4;
-  ulonglong uVar5;
-  void *pvVar6;
+  int iVar2;
+  long lVar3;
+  void *pvVar4;
+  MUTEX *this_00;
+  uint uVar5;
+  ulonglong uVar6;
   void *pvVar7;
-  int iVar8;
-  void *local_res8;
-  _RPC_MESSAGE *local_res10;
-  int local_res18;
+  void *pvVar8;
+  uint uVar9;
+  uint local_res18 [2];
+  void *local_res20;
   
   uVar1 = *(uint *)(param_1 + 0x48);
-  lVar2 = 0;
-  local_res18 = 0;
-  uVar4 = uVar1 & 0x4000 | param_2;
-  this_00 = this + 0x1e0;
-  local_res10 = param_1;
+  lVar3 = 0;
+  uVar5 = uVar1 & 0x4000 | param_2;
+  this_00 = (MUTEX *)(this + 0x1e0);
   RtlEnterCriticalSection();
-  iVar8 = *(int *)(this + 0x24c);
-  if (iVar8 != 0) {
-    if (uVar4 != 0) {
-      iVar8 = iVar8 + *(int *)(param_1 + 0x18);
+  uVar9 = *(uint *)(this + 0x24c);
+  if (uVar9 != 0) {
+    if (uVar5 != 0) {
+      this_00 = (MUTEX *)(ulonglong)uVar9;
+      lVar3 = UIntAdd(uVar9,*(uint *)(param_1 + 0x18),local_res18);
+      uVar9 = local_res18[0];
+      if (lVar3 < 0) {
+        lVar3 = 0x6c6;
+        goto LAB_1800ae674;
+      }
     }
-    lVar2 = TransGetBuffer((OSF_SCONNECTION *)this_00,&local_res8,iVar8 + 0x18);
-    if (lVar2 == 0) {
-      pvVar7 = (void *)((longlong)local_res8 + 0x18);
-      pvVar6 = pvVar7;
-      local_res8 = pvVar7;
-      if ((uVar4 != 0) && (*(longlong *)(param_1 + 0x10) != 0)) {
-        memcpy(pvVar7,*(longlong *)(param_1 + 0x10),(ulonglong)*(uint *)(param_1 + 0x18));
-        local_res8 = (void *)((ulonglong)*(uint *)(param_1 + 0x18) + (longlong)pvVar7);
+    lVar3 = TransGetBuffer((OSF_SCONNECTION *)this_00,&local_res20,uVar9 + 0x18);
+    if (lVar3 == 0) {
+      pvVar8 = (void *)((longlong)local_res20 + 0x18);
+      local_res20 = pvVar8;
+      if ((uVar5 != 0) && (*(longlong *)(param_1 + 0x10) != 0)) {
+        memcpy(pvVar8,*(longlong *)(param_1 + 0x10),(ulonglong)*(uint *)(param_1 + 0x18));
+        local_res20 = (void *)((ulonglong)*(uint *)(param_1 + 0x18) + (longlong)pvVar8);
         (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
-        pvVar6 = local_res8;
         if (((uVar1 & 0x4000) != 0) &&
-           ((*(void **)(*(longlong *)(param_1 + 0x30) + 8) = pvVar7, *(int *)(this + 0x1cc) == 0 &&
+           ((*(void **)(*(longlong *)(param_1 + 0x30) + 8) = pvVar8, *(int *)(this + 0x1cc) == 0 &&
             (*(longlong *)(param_1 + 0x10) == *(longlong *)(this + 0xe0))))) {
-          *(void **)(this + 0xe0) = pvVar7;
+          *(void **)(this + 0xe0) = pvVar8;
         }
       }
-      while (pvVar3 = TakeOffQueue((QUEUE *)(this + 600),(uint *)&local_res8), pvVar3 != (void *)0x0
-            ) {
-        uVar5 = (ulonglong)local_res8 & 0xffffffff;
-        memcpy(pvVar6,pvVar3,(ulonglong)local_res8 & 0xffffffff);
+      pvVar4 = TakeOffQueue((QUEUE *)(this + 600),local_res18);
+      pvVar7 = local_res20;
+      while (pvVar4 != (void *)0x0) {
+        uVar6 = (ulonglong)local_res18[0];
+        memcpy(pvVar7,pvVar4,(ulonglong)local_res18[0]);
+        pvVar7 = (void *)((longlong)pvVar7 + uVar6);
         (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
-        pvVar6 = (void *)((longlong)pvVar6 + uVar5);
+        pvVar4 = TakeOffQueue((QUEUE *)(this + 600),local_res18);
       }
-      *(void **)(local_res10 + 0x10) = pvVar7;
-      *(int *)(local_res10 + 0x18) = iVar8;
+      *(void **)(param_1 + 0x10) = pvVar8;
+      *(uint *)(param_1 + 0x18) = uVar9;
       *(undefined4 *)(this + 0x24c) = 0;
       if (*(int *)(this + 0x21c) == 3) {
-        *(uint *)(local_res10 + 0x48) = *(uint *)(local_res10 + 0x48) | 0x1000;
+        *(uint *)(param_1 + 0x48) = *(uint *)(param_1 + 0x48) | 0x1000;
       }
-      if (*(int *)(this + 0x2ac) != 0) {
-        local_res18 = 1;
+      iVar2 = *(int *)(this + 0x2ac);
+      if (iVar2 != 0) {
         *(undefined4 *)(this + 0x2ac) = 0;
       }
-      RtlLeaveCriticalSection(this + 0x1e0);
-      if (local_res18 != 0) {
+      Clear((MUTEX *)(this + 0x1e0));
+      if (iVar2 != 0) {
         (**(code **)(**(longlong **)(this + 0x130) + 0x38))();
       }
       return 0;
     }
-    lVar2 = 0xe;
+    lVar3 = 0xe;
   }
-  RtlLeaveCriticalSection(this + 0x1e0);
-  return lVar2;
+LAB_1800ae674:
+  Clear((MUTEX *)(this + 0x1e0));
+  return lVar3;
 }

 @@ -10944,32 +10949,35 @@ ProcessBindAckOrNak(OSF_CASSOCIATION *this,rpcconn_common *param_1,uint param_2,
   rpcconn_common rVar2;
   short sVar3;
   byte bVar4;
-  long lVar5;
-  longlong lVar6;
-  char *pcVar7;
-  ushort *puVar8;
-  ulonglong uVar9;
-  rpcconn_common *prVar10;
-  int iVar11;
-  ushort uVar12;
-  ulonglong uVar13;
-  uint uVar14;
-  bool bVar15;
-  ulong uVar16;
+  char *pcVar5;
+  uint uVar6;
+  ulonglong uVar7;
+  rpcconn_common *prVar8;
+  long lVar9;
+  uint uVar10;
+  undefined4 in_register_00000084;
+  undefined8 uVar11;
+  ushort *puVar12;
+  int iVar13;
+  ushort uVar14;
+  ulonglong uVar15;
+  bool bVar16;
+  ulong uVar17;
   
+  uVar11 = CONCAT44(in_register_00000084,param_2);
   *(uint *)(this + 0xfc) = (uint)*(ushort *)(param_1 + 4);
   rVar1 = param_1[2];
   if ((rVar1 == (rpcconn_common)0xc) || (rVar1 == (rpcconn_common)0xf)) {
-    uVar9 = 0;
+    uVar7 = 0;
     *(undefined4 *)(this + 0xf4) = 0;
     if (((byte)param_1[4] & 0xf0) != 0x10) {
       *(ushort *)(param_1 + 0x10) =
            *(ushort *)(param_1 + 0x10) >> 8 | *(ushort *)(param_1 + 0x10) << 8;
       *(ushort *)(param_1 + 0x12) =
            *(ushort *)(param_1 + 0x12) >> 8 | *(ushort *)(param_1 + 0x12) << 8;
-      uVar14 = *(uint *)(param_1 + 0x14);
+      uVar6 = *(uint *)(param_1 + 0x14);
       *(uint *)(param_1 + 0x14) =
-           uVar14 >> 0x18 | (uVar14 & 0xff0000) >> 8 | (uVar14 & 0xff00) << 8 | uVar14 << 0x18;
+           uVar6 >> 0x18 | (uVar6 & 0xff0000) >> 8 | (uVar6 & 0xff00) << 8 | uVar6 << 0x18;
       *(ushort *)(param_1 + 0x18) =
            *(ushort *)(param_1 + 0x18) >> 8 | *(ushort *)(param_1 + 0x18) << 8;
     }
@@ -10977,11 +10985,11 @@ ProcessBindAckOrNak(OSF_CASSOCIATION *this,rpcconn_common *param_1,uint param_2,
       if (((byte)param_1[3] & 0x10) != 0) {
         *(undefined4 *)(this + 0xf8) = 1;
       }
-      uVar12 = *(ushort *)(param_1 + 0x10);
-      uVar14 = *(uint *)(*(longlong *)(param_3 + 0x198) + 0x4c);
-      *(ushort *)(param_3 + 0x30) = uVar12;
-      if ((uVar14 < uVar12) || (uVar12 == 0)) {
-        *(short *)(param_3 + 0x30) = (short)uVar14;
+      uVar14 = *(ushort *)(param_1 + 0x10);
+      uVar6 = *(uint *)(*(longlong *)(param_3 + 0x198) + 0x4c);
+      *(ushort *)(param_3 + 0x30) = uVar14;
+      if ((uVar6 < uVar14) || (uVar14 == 0)) {
+        *(short *)(param_3 + 0x30) = (short)uVar6;
       }
       LOCK();
       *(uint *)(param_3 + 0x70) = *(uint *)(param_3 + 0x70) | 0x200;
@@ -10989,73 +10997,77 @@ ProcessBindAckOrNak(OSF_CASSOCIATION *this,rpcconn_common *param_1,uint param_2,
         return 0x6c0;
       }
     }
-    uVar14 = 2;
+    prVar8 = param_1 + 0x1a;
+    uVar6 = param_2 - 0x1a;
     if (*(short *)(param_1 + 0x18) == 0) {
-      param_2 = param_2 - 0x1c;
+      if (param_1[2] == (rpcconn_common)0xf) {
+        prVar8 = param_1 + 0x1c;
+        uVar6 = param_2 - 0x1c;
+      }
     }
     else {
-      uVar14 = (-(uint)*(ushort *)(param_1 + 0x18) - 2 & 3) + (uint)*(ushort *)(param_1 + 0x18);
-      if (param_2 - 0x1a < uVar14) {
+      uVar10 = (-(uint)*(ushort *)(param_1 + 0x18) - 2 & 3) + (uint)*(ushort *)(param_1 + 0x18);
+      if (uVar6 < uVar10) {
         return 0x6c0;
       }
-      param_2 = (param_2 - 0x1a) - uVar14;
+      uVar6 = uVar6 - uVar10;
+      prVar8 = prVar8 + uVar10;
     }
-    prVar10 = param_1 + (ulonglong)uVar14 + 0x1a;
-    rVar1 = *prVar10;
-    if ((ulonglong)param_2 < (ulonglong)(byte)rVar1 * 0x18 + 4) {
+    rVar1 = *prVar8;
+    if ((ulonglong)uVar6 < (ulonglong)(byte)rVar1 * 0x18 + 4) {
       return 0x6c0;
     }
     rVar2 = param_1[4];
-    iVar11 = -1;
+    iVar13 = -1;
     if (rVar1 != (rpcconn_common)0x0) {
-      puVar8 = (ushort *)(prVar10 + 0xe);
-      uVar13 = uVar9;
+      puVar12 = (ushort *)(prVar8 + 0xe);
+      uVar15 = uVar7;
       do {
-        uVar12 = puVar8[-5];
+        uVar14 = puVar12[-5];
         if (((byte)rVar2 & 0xf0) != 0x10) {
-          puVar8[-4] = puVar8[-4] >> 8 | puVar8[-4] << 8;
-          uVar12 = uVar12 >> 8 | uVar12 << 8;
-          puVar8[-5] = uVar12;
-          uVar14 = *(uint *)(puVar8 + -3);
-          *(uint *)(puVar8 + -3) =
-               uVar14 >> 0x18 | (uVar14 & 0xff0000) >> 8 | (uVar14 & 0xff00) << 8 | uVar14 << 0x18;
-          puVar8[-1] = puVar8[-1] >> 8 | puVar8[-1] << 8;
-          *puVar8 = *puVar8 >> 8 | *puVar8 << 8;
-          uVar14 = *(uint *)(puVar8 + 5);
-          *(uint *)(puVar8 + 5) =
-               uVar14 >> 0x18 | (uVar14 & 0xff0000) >> 8 | (uVar14 & 0xff00) << 8 | uVar14 << 0x18;
-        }
-        if (uVar12 == 0) {
-          bVar15 = -1 < iVar11;
-          iVar11 = (int)uVar9;
-          if (bVar15) {
+          puVar12[-4] = puVar12[-4] >> 8 | puVar12[-4] << 8;
+          uVar14 = uVar14 >> 8 | uVar14 << 8;
+          puVar12[-5] = uVar14;
+          uVar6 = *(uint *)(puVar12 + -3);
+          *(uint *)(puVar12 + -3) =
+               uVar6 >> 0x18 | (uVar6 & 0xff0000) >> 8 | (uVar6 & 0xff00) << 8 | uVar6 << 0x18;
+          puVar12[-1] = puVar12[-1] >> 8 | puVar12[-1] << 8;
+          *puVar12 = *puVar12 >> 8 | *puVar12 << 8;
+          uVar6 = *(uint *)(puVar12 + 5);
+          *(uint *)(puVar12 + 5) =
+               uVar6 >> 0x18 | (uVar6 & 0xff0000) >> 8 | (uVar6 & 0xff00) << 8 | uVar6 << 0x18;
+        }
+        if (uVar14 == 0) {
+          bVar16 = -1 < iVar13;
+          iVar13 = (int)uVar7;
+          if (bVar16) {
             return 0x6c0;
           }
         }
         else {
-          if (uVar12 == 3) {
+          if (uVar14 == 3) {
             if (*(int *)(this + 0x24) != 0) {
               return 0x6c0;
             }
-            bVar4 = *(byte *)(puVar8 + -4);
+            bVar4 = *(byte *)(puVar12 + -4);
             if ((bVar4 & 1) != 0) {
               *(uint *)(this + 0x13c) = *(uint *)(this + 0x13c) | 4;
-              bVar4 = *(byte *)(puVar8 + -4);
+              bVar4 = *(byte *)(puVar12 + -4);
             }
             if ((bVar4 & 2) != 0) {
               *(uint *)(this + 0x13c) = *(uint *)(this + 0x13c) | 8;
             }
           }
         }
-        uVar9 = (ulonglong)((int)uVar9 + 1);
-        uVar13 = uVar13 + 1;
-        puVar8 = puVar8 + 0xc;
-      } while ((longlong)uVar13 < (longlong)(ulonglong)(byte)rVar1);
-      if (-1 < iVar11) {
-        lVar5 = BindCompleteNotify(param_4,(p_result_t *)(prVar10 + (longlong)iVar11 * 0x18 + 4),
-                                   iVar11,param_5);
-        if (lVar5 != 0) {
-          return lVar5;
+        uVar7 = (ulonglong)((int)uVar7 + 1);
+        uVar15 = uVar15 + 1;
+        puVar12 = puVar12 + 0xc;
+      } while ((longlong)uVar15 < (longlong)(ulonglong)(byte)rVar1);
+      if (-1 < iVar13) {
+        lVar9 = BindCompleteNotify(param_4,(p_result_t *)(prVar8 + (longlong)iVar13 * 0x18 + 4),
+                                   iVar13,param_5);
+        if (lVar9 != 0) {
+          return lVar9;
         }
         if (param_1[2] == (rpcconn_common)0xc) {
           *(undefined4 *)(this + 0x24) = *(undefined4 *)(param_1 + 0x14);
@@ -11070,8 +11082,8 @@ ProcessBindAckOrNak(OSF_CASSOCIATION *this,rpcconn_common *param_1,uint param_2,
         return 0;
       }
     }
-    if (*(short *)(prVar10 + 4) == 2) {
-      sVar3 = *(short *)(prVar10 + 6);
+    if (*(short *)(prVar8 + 4) == 2) {
+      sVar3 = *(short *)(prVar8 + 6);
       if (sVar3 == 1) {
         return 0x6b5;
       }
@@ -11088,84 +11100,80 @@ ProcessBindAckOrNak(OSF_CASSOCIATION *this,rpcconn_common *param_1,uint param_2,
     return 0x6c0;
   }
   if (param_2 < 0x15) {
-    uVar12 = 700;
-    uVar16 = 0x15;
-    lVar5 = 0x6c0;
+    uVar14 = 700;
+    uVar17 = 0x15;
+    lVar9 = 0x6c0;
   }
   else {
     if (((byte)param_1[4] & 0xf0) != 0x10) {
       *(ushort *)(param_1 + 0x10) =
            *(ushort *)(param_1 + 0x10) >> 8 | *(ushort *)(param_1 + 0x10) << 8;
     }
-    uVar9 = 0;
-    if (0x28 < *(ushort *)(param_1 + 8)) {
-      lVar6 = *(longlong *)(param_1 + 0x18) + -0x11d3fad090740320;
-      if (lVar6 == 0) {
-        lVar6 = *(longlong *)(param_1 + 0x20) + 0x54cf4ed86fff287e;
-      }
-      if (lVar6 == 0) {
-        UnpickleEEInfoFromBuffer(param_1 + 0x28,(ulonglong)*(ushort *)(param_1 + 8) - 0x28);
-      }
+    if (((0x28 < *(ushort *)(param_1 + 8)) && (*(longlong *)(param_1 + 0x18) == 0x11d3fad090740320))
+       && (*(longlong *)(param_1 + 0x20) == -0x54cf4ed86fff287e)) {
+      UnpickleEEInfoFromBuffer(param_1 + 0x28,(ulonglong)*(ushort *)(param_1 + 8) - 0x28);
     }
-    uVar12 = *(ushort *)(param_1 + 0x10);
-    if ((ushort)(uVar12 - 1) < 2) {
-      lVar5 = 0x6bb;
+    uVar14 = *(ushort *)(param_1 + 0x10);
+    if ((ushort)(uVar14 - 1) < 2) {
+      lVar9 = 0x6bb;
     }
     else {
-      if (uVar12 == 4) {
-        lVar5 = 0x6c0;
-        uVar12 = 4;
+      if (uVar14 == 4) {
+        lVar9 = 0x6c0;
+        uVar14 = 4;
       }
       else {
-        if (uVar12 == 8) {
-          lVar5 = 0x6d3;
-          uVar12 = 8;
+        if (uVar14 == 8) {
+          lVar9 = 0x6d3;
+          uVar14 = 8;
         }
         else {
-          if (uVar12 == 9) {
-            lVar5 = 5;
-            uVar12 = 9;
+          if (uVar14 == 9) {
+            lVar9 = 5;
+            uVar14 = 9;
           }
           else {
             *(int *)(this + 0xf4) = *(int *)(this + 0xf4) + 1;
-            lVar5 = 0x6bf;
+            lVar9 = 0x6bf;
             if (*(int *)(this + 0xf4) < 0x28) {
               if (param_6 != (FAILURE_COUNT_STATE *)0x0) {
                 *param_6 = 1;
               }
             }
             else {
+              uVar7 = 0;
               if (DAT_1801091d4 != 0) {
-                pcVar7 = "HbBrn";
+                pcVar5 = "HbBrn";
                 do {
-                  if (*pcVar7 == 'a') goto LAB_1800788d2;
-                  uVar14 = (int)uVar9 + 1;
-                  pcVar7 = pcVar7 + 1;
-                  uVar9 = (ulonglong)uVar14;
-                } while (uVar14 < 4);
+                  if (*pcVar5 == 'a') goto LAB_180009e18;
+                  uVar6 = (int)uVar7 + 1;
+                  pcVar5 = pcVar5 + 1;
+                  uVar7 = (ulonglong)uVar6;
+                } while (uVar6 < 4);
                 if (((byte)Microsoft_Windows_RPCEnableBits & 8) != 0) {
                   McTemplateU0uuxxx_EtwEventWriteTransfer
-                            (4,uVar9,0x61,0x52,(char)this,0,(char)*(int *)(this + 0xf4));
+                            (4,uVar7,CONCAT71((int7)((ulonglong)uVar11 >> 8),0x61),0x52,(char)this,0
+                             ,(char)*(int *)(this + 0xf4));
                 }
               }
-LAB_1800788d2:
+LAB_180009e18:
               *(undefined4 *)(this + 0xe0) = 0;
               *(undefined4 *)(this + 0xe4) = 0x6bf;
               if (param_6 != (FAILURE_COUNT_STATE *)0x0) {
                 *param_6 = 2;
               }
             }
-            uVar12 = *(ushort *)(param_1 + 0x10);
+            uVar14 = *(ushort *)(param_1 + 0x10);
           }
         }
       }
     }
-    param_2 = (uint)uVar12;
-    uVar12 = 0x2bd;
-    uVar16 = *(ulong *)(this + 0xf4);
+    param_2 = (uint)uVar14;
+    uVar14 = 0x2bd;
+    uVar17 = *(ulong *)(this + 0xf4);
   }
-  RpcpErrorAddRecord(2,lVar5,uVar12,param_2,uVar16);
-  return lVar5;
+  RpcpErrorAddRecord(2,lVar9,uVar14,param_2,uVar17);
+  return lVar9;
 }

 @@ -24363,19 +24376,20 @@ int __thiscall ProcessReceivedPDU(OSF_SCALL *this,rpcconn_common *param_1,uint p
 
 {
   OSF_SCALL **ppOVar1;
-  OSF_SCALL *pOVar2;
+  MUTEX *this_00;
+  rpcconn_common rVar2;
   uint *puVar3;
-  long lVar4;
-  int iVar5;
+  int iVar4;
+  long lVar5;
   int iVar6;
   int iVar7;
-  int iVar8;
-  longlong lVar9;
-  char *pcVar10;
-  uint uVar11;
-  rpcconn_common rVar12;
-  OSF_SCALL **ppOVar13;
-  ushort uVar14;
+  longlong lVar8;
+  char *pcVar9;
+  ulonglong uVar10;
+  rpcconn_common rVar11;
+  OSF_SCALL **ppOVar12;
+  ushort uVar13;
+  uint uVar14;
   uint uVar15;
   ulong *puVar16;
   int iVar17;
@@ -24385,327 +24399,331 @@ int __thiscall ProcessReceivedPDU(OSF_SCALL *this,rpcconn_common *param_1,uint p
   undefined4 local_50 [2];
   uint local_48;
   
-  iVar5 = *(int *)(this + 0x1cc);
-  _uVar11 = 0;
-  iVar6 = 0;
-  iVar7 = 0;
+  iVar7 = *(int *)(this + 0x1cc);
+  uVar10 = 0;
+  iVar4 = 0;
   iVar17 = 1;
-  uVar11 = 0;
   local_res8[0] = param_2;
   if (*(int *)(this + 0x220) == 0) {
-    rVar12 = param_1[2];
-    if ((rVar12 != (rpcconn_common)0x0) && (rVar12 != (rpcconn_common)0x2)) {
-      if (rVar12 != (rpcconn_common)0x3) {
-        if ((byte)((char)rVar12 - 0x12U) < 2) {
+    rVar11 = param_1[2];
+    if (((byte)rVar11 & 0xfd) != 0) {
+      if (rVar11 != (rpcconn_common)0x3) {
+        if ((byte)((char)rVar11 - 0x12U) < 2) {
           (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
           if (*(int *)(this + 0x2e8) != 0) {
             return 0;
           }
           *(undefined4 *)(this + 0x2e8) = 1;
-          if (rVar12 == (rpcconn_common)0x13) {
-            iVar7 = WakeUpPipeThreadIfNecessary(this,0x71a);
+          if (rVar11 == (rpcconn_common)0x13) {
+            iVar4 = WakeUpPipeThreadIfNecessary(this,0x71a);
           }
-          if (*(byte **)(this + 0xf0) != (byte *)0x0) {
-            if ((**(byte **)(this + 0xf0) & 2) != 0) {
-              IssueCallStatusChangeNotification((SCALL *)this,4);
-              return iVar7;
-            }
-            return iVar7;
+          if (*(byte **)(this + 0xf0) == (byte *)0x0) {
+            return iVar4;
+          }
+          if ((**(byte **)(this + 0xf0) & 2) == 0) {
+            return iVar4;
           }
-          return iVar7;
+          IssueCallStatusChangeNotification((SCALL *)this,4);
+          return iVar4;
         }
-        goto LAB_18007ff88;
-      }
-      if (iVar5 == 0) {
-        lVar9 = **(longlong **)(this + 0x130);
-        goto LAB_18007fe7d;
-      }
-      uVar15 = *(uint *)(param_1 + 0x18);
-      if ((uVar15 == 0) && (0x23 < *(ushort *)(param_1 + 8))) {
-        uVar15 = *(uint *)(param_1 + 0x20);
-      }
-      if (((byte)param_1[4] & 0xf0) != 0x10) {
-        uVar15 = uVar15 >> 0x18 | (uVar15 & 0xff0000) >> 8 | (uVar15 & 0xff00) << 8 | uVar15 << 0x18
-        ;
+        goto LAB_180014632;
       }
-      if (uVar15 == 0) {
-        uVar15 = 0x6be;
-      }
-      do {
-        if ((&DAT_1800ee7b0)[(ulonglong)(uVar11 * 2) * 4] == uVar15) {
-          uVar15 = (&DAT_1800ee7b0)[(ulonglong)(uVar11 * 2 + 1) * 4];
-          break;
+      if (iVar7 != 0) {
+        uVar14 = *(uint *)(param_1 + 0x18);
+        if ((uVar14 == 0) && (0x23 < *(ushort *)(param_1 + 8))) {
+          uVar14 = *(uint *)(param_1 + 0x20);
         }
-        uVar11 = uVar11 + 1;
-      } while (uVar11 < 0x26);
-      *(uint *)(this + 0x20) = uVar15;
-      iVar5 = RpcpIsFatalError(uVar15);
-      *(undefined4 *)(this + 0x21c) = 6;
-      if (iVar5 != 0) {
-        uVar15 = 0x6c0;
+        if (((byte)param_1[4] & 0xf0) != 0x10) {
+          uVar14 = uVar14 >> 0x18 | (uVar14 & 0xff0000) >> 8 | (uVar14 & 0xff00) << 8 |
+                   uVar14 << 0x18;
+        }
+        if (uVar14 == 0) {
+          uVar14 = 0x6be;
+          uVar10 = 0;
+        }
+        do {
+          iVar7 = (int)uVar10;
+          if ((&DAT_1800ee7b0)[(ulonglong)(uint)(iVar7 * 2) * 4] == uVar14) {
+            uVar14 = (&DAT_1800ee7b0)[(ulonglong)(iVar7 * 2 + 1) * 4];
+            break;
+          }
+          uVar10 = (ulonglong)(iVar7 + 1U);
+        } while (iVar7 + 1U < 0x26);
+        *(uint *)(this + 0x20) = uVar14;
+        iVar7 = RpcpIsFatalError(uVar14);
+        *(undefined4 *)(this + 0x21c) = 6;
+        if (iVar7 != 0) {
+          uVar14 = 0x6c0;
+        }
+        *(uint *)(this + 0x20) = uVar14;
+        SetEvent(*(undefined8 *)(this + 0x2c0));
+        goto LAB_1800145b7;
       }
-      *(uint *)(this + 0x20) = uVar15;
-      SetEvent(*(undefined8 *)(this + 0x2c0));
-LAB_18007fe66:
-      lVar9 = **(longlong **)(this + 0x130);
-LAB_18007fe7d:
-      (**(code **)(lVar9 + 0x40))();
-      return 0;
+      lVar8 = **(longlong **)(this + 0x130);
+      goto LAB_18001447c;
     }
-    local_res18 = param_1[3];
+    rVar2 = param_1[3];
     puVar16 = local_res8;
-    ppOVar13 = (OSF_SCALL **)param_1;
-    lVar4 = EatAuthInfoFromPacket(this,(rpcconn_request *)param_1,puVar16,param_3);
-    if (lVar4 == 0) {
-      if ((*(int *)(this + 0x21c) != 0) && (*(int *)(this + 0x1cc) == 0)) goto LAB_18007fe66;
-      if ((char)local_res18 < '\0') {
-        if (*(int *)(this + 0x1cc) != 0) goto LAB_18007ff88;
-        puVar16 = (ulong *)(ulonglong)local_res8[0];
-        ppOVar13 = (OSF_SCALL **)(param_1 + 0x28);
-        memcpy(param_1 + 0x18);
-      }
-      ppOVar1 = (OSF_SCALL **)(this + 0xe0);
-      if (((byte)local_res18 & 1) == 0) {
-        if (*ppOVar1 != (OSF_SCALL *)0x0) {
-LAB_180080057:
-          uVar11 = local_res8[0];
-          if ((*(int *)(this + 0x244) == 0) || (*(int *)(this + 0x1cc) != 0)) {
-            if ((*(int *)(this + 0x214) == 0) || (*(int *)(this + 0x1cc) != 0)) {
-              uVar11 = local_res8[0] + *(uint *)(this + 0x1d8);
-              if (*(uint *)(this + 0x248) <= uVar11 && uVar11 != *(uint *)(this + 0x248)) {
-                if (*(int *)(this + 0x1cc) != 0) goto LAB_18007ff88;
-                *(uint *)(this + 0x248) = uVar11;
-                puVar3 = (uint *)(**(OSF_SCALL ***)(this + 0x138) + 0x148);
-                if (*puVar3 <= uVar11 && uVar11 != *puVar3) {
-                  uVar14 = 0x1073;
-                  local_48 = uVar11;
-                  goto LAB_180080004;
-                }
-                lVar4 = GetBufferDo(**(OSF_SCALL ***)(this + 0x138),ppOVar1,uVar11,1,
-                                    *(uint *)(this + 0x1d8),in_stack_ffffffffffffff90);
-                if (lVar4 != 0) goto LAB_180080398;
-              }
-              uVar11 = local_res8[0];
-              memcpy(*ppOVar1 + *(uint *)(this + 0x1d8),param_1 + 0x18,(ulonglong)local_res8[0]);
-              *(uint *)(this + 0x1d8) = *(int *)(this + 0x1d8) + uVar11;
-              (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
-              if (((byte)local_res18 & 2) == 0) {
-                return 0;
-              }
-              goto LAB_18001423c;
+    ppOVar12 = (OSF_SCALL **)param_1;
+    local_res18 = rVar2;
+    lVar5 = EatAuthInfoFromPacket(this,(rpcconn_request *)param_1,puVar16,param_3);
+    if (lVar5 != 0) {
+      puVar3 = *(uint **)(this + 0x158);
+      if ((puVar3 != (uint *)0x0) && ((3 < *puVar3 || (puVar3[0x55] != 0)))) {
+        *(undefined *)(puVar3 + 0x4d) = 1;
+      }
+      *(long *)(this + 0x220) = lVar5;
+      goto LAB_180014aa0;
+    }
+    if ((*(int *)(this + 0x21c) != 0) && (*(int *)(this + 0x1cc) == 0)) {
+LAB_1800145b7:
+      lVar8 = **(longlong **)(this + 0x130);
+      goto LAB_18001447c;
+    }
+    if ((char)rVar2 < '\0') {
+      if (*(int *)(this + 0x1cc) != 0) goto LAB_180014632;
+      puVar16 = (ulong *)(ulonglong)local_res8[0];
+      ppOVar12 = (OSF_SCALL **)(param_1 + 0x28);
+      memcpy(param_1 + 0x18);
+    }
+    ppOVar1 = (OSF_SCALL **)(this + 0xe0);
+    if (((byte)local_res18 & 1) == 0) {
+      if (*ppOVar1 == (OSF_SCALL *)0x0) goto LAB_180014632;
+LAB_180014750:
+      uVar14 = local_res8[0];
+      if ((*(int *)(this + 0x244) == 0) || (*(int *)(this + 0x1cc) != 0)) {
+        if ((*(int *)(this + 0x214) != 0) && (*(int *)(this + 0x1cc) == 0)) goto LAB_180014632;
+        uVar14 = local_res8[0] + *(uint *)(this + 0x1d8);
+        if (*(uint *)(this + 0x248) <= uVar14 && uVar14 != *(uint *)(this + 0x248)) {
+          if (*(int *)(this + 0x1cc) != 0) goto LAB_180014632;
+          *(uint *)(this + 0x248) = uVar14;
+          puVar3 = (uint *)(**(OSF_SCALL ***)(this + 0x138) + 0x148);
+          if (*puVar3 <= uVar14 && uVar14 != *puVar3) {
+            uVar13 = 0x1073;
+            local_48 = uVar14;
+            goto LAB_1800146ff;
+          }
+          lVar5 = GetBufferDo(**(OSF_SCALL ***)(this + 0x138),ppOVar1,uVar14,1,
+                              *(uint *)(this + 0x1d8),in_stack_ffffffffffffff90);
+          if (lVar5 != 0) goto LAB_180014a9b;
+        }
+        uVar14 = local_res8[0];
+        memcpy(*ppOVar1 + *(uint *)(this + 0x1d8),param_1 + 0x18,(ulonglong)local_res8[0]);
+        *(uint *)(this + 0x1d8) = *(int *)(this + 0x1d8) + uVar14;
+        (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
+        if (((byte)local_res18 & 2) != 0) goto LAB_180014688;
+        goto LAB_180014be4;
+      }
+      if (rVar11 != (rpcconn_common)0x0) goto LAB_180014632;
+      if (*(int *)(this + 0x214) == 0) {
+        uVar10 = (ulonglong)local_res8[0];
+        uVar15 = *(uint *)(this + 0x1d8) + local_res8[0];
+        if (uVar15 < *(uint *)(this + 0x248) || uVar15 == *(uint *)(this + 0x248)) {
+LAB_1800147d6:
+          memcpy((ulonglong)*(uint *)(this + 0x1d8) + *(longlong *)(this + 0xe0),param_1 + 0x18,
+                 uVar10);
+          *(uint *)(this + 0x1d8) = *(int *)(this + 0x1d8) + uVar14;
+          (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
+          if (*(int *)(this + 0x1d8) == *(int *)(this + 0x248)) {
+            if (((byte)local_res18 & 2) == 0) {
+              *(undefined4 *)(this + 0x230) = 0;
             }
-          }
-          else {
-            if (rVar12 == (rpcconn_common)0x0) {
-              if (*(int *)(this + 0x214) == 0) {
-                _uVar11 = (ulonglong)local_res8[0];
-                uVar15 = *(uint *)(this + 0x1d8) + local_res8[0];
-                if (*(uint *)(this + 0x248) <= uVar15 && uVar15 != *(uint *)(this + 0x248)) {
-                  *(uint *)(this + 0x248) = uVar15;
-                  puVar3 = (uint *)(**(OSF_SCALL ***)(this + 0x138) + 0x148);
-                  if (*puVar3 <= uVar15 && uVar15 != *puVar3) {
-                    uVar14 = 0x1074;
-                    local_48 = uVar15;
-LAB_180080004:
-                    lVar4 = 5;
-                    local_50[0] = 3;
-                    *(undefined4 *)(this + 0x220) = 5;
-                    RpcpErrorAddRecord(2,5,uVar14,1,(tagParam *)local_50);
-                    goto LAB_1800142be;
-                  }
-                  lVar4 = GetBufferDo(**(OSF_SCALL ***)(this + 0x138),ppOVar1,uVar15,1,
-                                      *(uint *)(this + 0x1d8),in_stack_ffffffffffffff90);
-                  if (lVar4 != 0) goto LAB_1800142be;
-                }
-                memcpy((ulonglong)*(uint *)(this + 0x1d8) + *(longlong *)(this + 0xe0),
-                       param_1 + 0x18,_uVar11);
-                *(uint *)(this + 0x1d8) = *(int *)(this + 0x1d8) + uVar11;
-                (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
-                if (*(int *)(this + 0x1d8) != *(int *)(this + 0x248)) {
-                  return 0;
-                }
-                if (((byte)local_res18 & 2) == 0) {
-                  *(undefined4 *)(this + 0x230) = 0;
-                }
-                else {
-                  *(undefined4 *)(this + 0x21c) = 3;
-                  if (((byte)this[0x2e0] & 4) != 0) {
-                    LOCK();
-                    *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) =
-                         *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) & 0xfffffffd;
-                    *(uint *)(this + 0x2e0) = *(uint *)(this + 0x2e0) & 0xfffffffb;
-                  }
-                }
-                rVar12 = (rpcconn_common)0x0;
-                goto LAB_180014256;
-              }
-              pOVar2 = this + 0x1e0;
-              RtlEnterCriticalSection();
-              if (((*(int *)(*(longlong *)(this + 0x130) + 0x18) == 0) ||
-                  (*(int *)(*(longlong *)(this + 0x130) + 0x1c) == 0)) &&
-                 (1 < *(int *)(this + 0x21c) - 2U)) {
-                if (DAT_1801091d4 != 0) {
-                  pcVar10 = "HbBrn";
-                  do {
-                    if (*pcVar10 == 'C') goto LAB_1800801ef;
-                    uVar11 = (int)_uVar11 + 1;
-                    _uVar11 = (ulonglong)uVar11;
-                    pcVar10 = pcVar10 + 1;
-                  } while (uVar11 < 4);
-                  if (((byte)Microsoft_Windows_RPCEnableBits & 8) != 0) {
-                    McTemplateU0uuxxx_EtwEventWriteTransfer
-                              (_uVar11,ppOVar13,CONCAT71((int7)((ulonglong)puVar16 >> 8),0x43),0x62,
-                               (char)param_1,(char)this,0);
-                  }
-                }
-LAB_1800801ef:
-                uVar11 = local_res8[0];
-                iVar8 = PutOnQueue((QUEUE *)(this + 600),param_1 + 0x18,local_res8[0]);
-                if (iVar8 == 0) {
-                  *(uint *)(this + 0x24c) = *(int *)(this + 0x24c) + uVar11;
-                  if ((((byte)local_res18 & 2) != 0) &&
-                     (*(undefined4 *)(this + 0x21c) = 3, ((byte)this[0x2e0] & 4) != 0)) {
-                    LOCK();
-                    *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) =
-                         *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) & 0xfffffffd;
-                    *(uint *)(this + 0x2e0) = *(uint *)(this + 0x2e0) & 0xfffffffb;
-                  }
-                  if (*(longlong *)(this + 0x18) != 0) {
-                    if ((*(uint *)(this + 0x250) == 0) ||
-                       ((*(uint *)(this + 0x24c) < *(uint *)(this + 0x250) &&
-                        (*(int *)(this + 0x21c) != 3)))) {
-                      if ((3 < *(int *)(this + 0x264)) &&
-                         ((*(int *)(*(longlong *)(this + 0x130) + 0x18) != 0 &&
-                          (*(int *)(this + 0x21c) != 3)))) {
-                        *(undefined4 *)(this + 0x2ac) = 1;
-                        iVar6 = iVar17;
-                      }
-                    }
-                    else {
-                      *(undefined4 *)(this + 0x250) = 0;
-                      IssueNotification((SCALL *)this,2);
-                      iVar6 = iVar7;
-                    }
-                    RtlLeaveCriticalSection(pOVar2);
-                    return iVar6;
-                  }
-                  if (((3 < *(int *)(this + 0x264)) &&
-                      (iVar7 = iVar6, *(int *)(*(longlong *)(this + 0x130) + 0x18) != 0)) &&
-                     (*(int *)(this + 0x21c) != 3)) {
-                    *(undefined4 *)(this + 0x2ac) = 1;
-                    iVar7 = iVar17;
-                  }
-                  RtlLeaveCriticalSection(pOVar2);
-                  SetEvent(*(undefined8 *)(this + 0x2c0));
-                  return iVar7;
-                }
-                RtlLeaveCriticalSection(pOVar2);
-                goto LAB_180080398;
+            else {
+              *(undefined4 *)(this + 0x21c) = 3;
+              if (((byte)this[0x2e0] & 4) != 0) {
+                LOCK();
+                *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) =
+                     *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) & 0xfffffffd;
+                *(uint *)(this + 0x2e0) = *(uint *)(this + 0x2e0) & 0xfffffffb;
               }
-              RtlLeaveCriticalSection(pOVar2);
-              goto LAB_18007fe66;
             }
+            rVar11 = (rpcconn_common)0x0;
+            goto LAB_1800146b4;
           }
+          goto LAB_180014be4;
+        }
+        *(uint *)(this + 0x248) = uVar15;
+        puVar3 = (uint *)(**(OSF_SCALL ***)(this + 0x138) + 0x148);
+        if (uVar15 < *puVar3 || uVar15 == *puVar3) {
+          lVar5 = GetBufferDo(**(OSF_SCALL ***)(this + 0x138),ppOVar1,uVar15,1,
+                              *(uint *)(this + 0x1d8),in_stack_ffffffffffffff90);
+          if (lVar5 == 0) goto LAB_1800147d6;
+        }
+        else {
+          uVar13 = 0x1074;
+          local_48 = uVar15;
+LAB_1800146ff:
+          lVar5 = 5;
+          local_50[0] = 3;
+          *(undefined4 *)(this + 0x220) = 5;
+          RpcpErrorAddRecord(2,5,uVar13,1,(tagParam *)local_50);
         }
       }
       else {
-        if ((*ppOVar1 == (OSF_SCALL *)0x0) || (*(int *)(this + 0x1cc) != 0)) {
-          if (((byte)local_res18 & 2) == 0) {
-            uVar11 = *(uint *)(param_1 + 0x10);
-            if (uVar11 == 0) {
-              *(uint *)(this + 0x248) = local_res8[0];
-              uVar11 = local_res8[0];
-            }
-            else {
-              *(uint *)(this + 0x248) = uVar11;
-            }
-            puVar16 = (ulong *)(ulonglong)uVar11;
-            if (*(uint *)(**(longlong **)(this + 0x138) + 0x148) <= uVar11 &&
-                uVar11 != *(uint *)(**(longlong **)(this + 0x138) + 0x148)) {
-              uVar14 = 0x1072;
-              local_48 = uVar11;
-              goto LAB_180080004;
-            }
-            *(undefined4 *)(this + 0x1d8) = 0;
-            ppOVar13 = ppOVar1;
-            lVar4 = GetBufferDo((OSF_SCALL *)(param_1 + 0x18),ppOVar1,uVar11,0,0,
-                                in_stack_ffffffffffffff90);
-            if (lVar4 == 0) goto LAB_180080057;
-LAB_180080398:
-            lVar4 = 0xe;
-            goto LAB_1800142be;
-          }
-          *(uint *)(this + 0x1d8) = local_res8[0];
-          *ppOVar1 = (OSF_SCALL *)(param_1 + 0x18);
-LAB_18001423c:
-          *(undefined4 *)(this + 0x21c) = 3;
-          if (((byte)this[0x2e0] & 4) != 0) {
+        this_00 = (MUTEX *)(this + 0x1e0);
+        RtlEnterCriticalSection();
+        if (((*(int *)(*(longlong *)(this + 0x130) + 0x18) != 0) &&
+            (*(int *)(*(longlong *)(this + 0x130) + 0x1c) != 0)) ||
+           (*(int *)(this + 0x21c) - 2U < 2)) {
+          Clear(this_00);
+          goto LAB_1800145b7;
+        }
+        if (DAT_1801091d4 != 0) {
+          pcVar9 = "HbBrn";
+          do {
+            if (*pcVar9 == 'C') goto LAB_1800148e8;
+            uVar14 = (int)uVar10 + 1;
+            uVar10 = (ulonglong)uVar14;
+            pcVar9 = pcVar9 + 1;
+          } while (uVar14 < 4);
+          if (((byte)Microsoft_Windows_RPCEnableBits & 8) != 0) {
+            McTemplateU0uuxxx_EtwEventWriteTransfer
+                      (uVar10,ppOVar12,CONCAT71((int7)((ulonglong)puVar16 >> 8),0x43),0x62,
+                       (char)param_1,(char)this,0);
+          }
+        }
+LAB_1800148e8:
+        uVar14 = local_res8[0];
+        iVar6 = PutOnQueue((QUEUE *)(this + 600),param_1 + 0x18,local_res8[0]);
+        if (iVar6 != 0) {
+          Clear(this_00);
+          goto LAB_180014a9b;
+        }
+        puVar16 = (ulong *)(this + 0x24c);
+        lVar5 = ULongAdd(*puVar16,uVar14,puVar16);
+        if (-1 < lVar5) {
+          if ((((byte)local_res18 & 2) != 0) &&
+             (*(undefined4 *)(this + 0x21c) = 3, ((byte)this[0x2e0] & 4) != 0)) {
             LOCK();
             *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) =
                  *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) & 0xfffffffd;
             *(uint *)(this + 0x2e0) = *(uint *)(this + 0x2e0) & 0xfffffffb;
           }
-LAB_180014256:
-          iVar5 = DispatchRPCCall(this,(uchar)rVar12);
-          return iVar5;
+          if (*(longlong *)(this + 0x18) == 0) {
+            if (((3 < *(int *)(this + 0x264)) && (*(int *)(*(longlong *)(this + 0x130) + 0x18) != 0)
+                ) && (*(int *)(this + 0x21c) != 3)) {
+              *(undefined4 *)(this + 0x2ac) = 1;
+              iVar4 = 1;
+            }
+            Clear(this_00);
+            SetEvent(*(undefined8 *)(this + 0x2c0));
+            return iVar4;
+          }
+          if ((*(uint *)(this + 0x250) == 0) ||
+             ((*puVar16 < *(uint *)(this + 0x250) && (*(int *)(this + 0x21c) != 3)))) {
+            if ((3 < *(int *)(this + 0x264)) &&
+               ((*(int *)(*(longlong *)(this + 0x130) + 0x18) != 0 &&
+                (iVar4 = 0, *(int *)(this + 0x21c) != 3)))) {
+              *(undefined4 *)(this + 0x2ac) = 1;
+              iVar4 = 1;
+            }
+          }
+          else {
+            *(undefined4 *)(this + 0x250) = 0;
+            IssueNotification((SCALL *)this,2);
+          }
+          Clear(this_00);
+          return iVar4;
         }
+        Clear(this_00);
+        lVar5 = 0x6c6;
       }
-LAB_18007ff88:
-      lVar4 = 0x6c0;
     }
     else {
-      puVar3 = *(uint **)(this + 0x158);
-      if ((puVar3 != (uint *)0x0) && ((3 < *puVar3 || (puVar3[0x55] != 0)))) {
-        *(undefined *)(puVar3 + 0x4d) = 1;
+      if ((*ppOVar1 == (OSF_SCALL *)0x0) || (*(int *)(this + 0x1cc) != 0)) {
+        if (((byte)local_res18 & 2) == 0) {
+          uVar14 = *(uint *)(param_1 + 0x10);
+          if (uVar14 == 0) {
+            *(uint *)(this + 0x248) = local_res8[0];
+            uVar14 = local_res8[0];
+          }
+          else {
+            *(uint *)(this + 0x248) = uVar14;
+          }
+          puVar16 = (ulong *)(ulonglong)uVar14;
+          if (*(uint *)(**(longlong **)(this + 0x138) + 0x148) <= uVar14 &&
+              uVar14 != *(uint *)(**(longlong **)(this + 0x138) + 0x148)) {
+            uVar13 = 0x1072;
+            local_48 = uVar14;
+            goto LAB_1800146ff;
+          }
+          *(undefined4 *)(this + 0x1d8) = 0;
+          ppOVar12 = ppOVar1;
+          lVar5 = GetBufferDo((OSF_SCALL *)(param_1 + 0x18),ppOVar1,uVar14,0,0,
+                              in_stack_ffffffffffffff90);
+          if (lVar5 == 0) goto LAB_180014750;
+LAB_180014a9b:
+          lVar5 = 0xe;
+          goto LAB_180014aa0;
+        }
+        *(uint *)(this + 0x1d8) = local_res8[0];
+        *ppOVar1 = (OSF_SCALL *)(param_1 + 0x18);
+LAB_180014688:
+        *(undefined4 *)(this + 0x21c) = 3;
+        if (((byte)this[0x2e0] & 4) != 0) {
+          LOCK();
+          *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) =
+               *(uint *)(*(longlong *)(this + 0x130) + 0x1ac) & 0xfffffffd;
+          *(uint *)(this + 0x2e0) = *(uint *)(this + 0x2e0) & 0xfffffffb;
+        }
+LAB_1800146b4:
+        iVar7 = DispatchRPCCall(this,(uchar)rVar11);
+        return iVar7;
       }
-      *(long *)(this + 0x220) = lVar4;
+LAB_180014632:
+      lVar5 = 0x6c0;
     }
-LAB_1800142be:
+LAB_180014aa0:
     (**(code **)(**(longlong **)(this + 0x130) + 0x40))();
-    if ((iVar5 == 0) && (*(int *)(this + 0x214) == 0)) {
-      CleanupCallAndSendFault(this,lVar4,0);
-      iVar8 = iVar17;
-      goto LAB_180014308;
+    if ((iVar7 != 0) || (*(int *)(this + 0x214) != 0)) {
+      SendFault(this,lVar5,0);
+      goto LAB_180014af4;
+    }
+    CleanupCallAndSendFault(this,lVar5,0);
+    iVar4 = iVar17;
+LAB_180014afd:
+    if (*(int *)(this + 0x214) == 0) {
+      if (iVar4 == 0) {
+        CleanupCall(this);
+      }
+      iVar7 = IsAccessDeniedError(lVar5);
+      if ((iVar7 == 0) || (iVar7 = 0, *(uint *)(*(longlong *)(this + 0x130) + 0x14c) < 2)) {
+        *(uint *)(*(longlong *)(this + 0x130) + 0x184) = (uint)(*(int *)(this + 0x21c) == 0);
+        Delete(*(REFERENCED_OBJECT **)(this + 0x130));
+        iVar7 = iVar17;
+      }
+      RemoveReference(this);
+      RemoveReference(this);
+    }
+    else {
+      iVar7 = IsAccessDeniedError(lVar5);
+      if ((iVar7 == 0) || (iVar7 = 0, *(uint *)(*(longlong *)(this + 0x130) + 0x14c) < 2)) {
+        Delete(*(REFERENCED_OBJECT **)(this + 0x130));
+        iVar7 = iVar17;
+      }
     }
-    SendFault(this,lVar4,0);
   }
   else {
     puVar3 = *(uint **)(this + 0x158);
     if ((puVar3 != (uint *)0x0) && ((3 < *puVar3 || (puVar3[0x55] != 0)))) {
       *(undefined *)(puVar3 + 0x4d) = 1;
     }
-    lVar9 = **(longlong **)(this + 0x130);
-    if (((byte)param_1[3] & 2) == 0) goto LAB_18007fe7d;
-    (**(code **)(lVar9 + 0x40))();
-    lVar4 = *(long *)(this + 0x220);
-  }
-  iVar8 = iVar6;
-  if (iVar5 != 0) {
-    return 0;
-  }
-LAB_180014308:
-  if (*(int *)(this + 0x214) == 0) {
-    if (iVar8 == 0) {
-      CleanupCall(this);
-    }
-    iVar5 = IsAccessDeniedError(lVar4);
-    if ((iVar5 == 0) || (*(uint *)(*(longlong *)(this + 0x130) + 0x14c) < 2)) {
-      *(uint *)(*(longlong *)(this + 0x130) + 0x184) = (uint)(*(int *)(this + 0x21c) == 0);
-      Delete(*(REFERENCED_OBJECT **)(this + 0x130));
-      iVar7 = iVar17;
+    lVar8 = **(longlong **)(this + 0x130);
+    if (((byte)param_1[3] & 2) == 0) {
+LAB_18001447c:
+      (**(code **)(lVar8 + 0x40))();
     }
-    RemoveReference(this);
-    RemoveReference(this);
-    iVar6 = iVar7;
-  }
-  else {
-    iVar5 = IsAccessDeniedError(lVar4);
-    if ((iVar5 == 0) || (*(uint *)(*(longlong *)(this + 0x130) + 0x14c) < 2)) {
-      Delete(*(REFERENCED_OBJECT **)(this + 0x130));
-      iVar6 = iVar17;
+    else {
+      (**(code **)(lVar8 + 0x40))();
+      lVar5 = *(long *)(this + 0x220);
+LAB_180014af4:
+      iVar4 = 0;
+      if (iVar7 == 0) goto LAB_180014afd;
     }
+LAB_180014be4:
+    iVar7 = 0;
   }
-  return iVar6;
+  return iVar7;
 }

 @@ -140911,51 +141242,58 @@ long __thiscall
 ProcessResponse(OSF_CCALL *this,rpcconn_response *param_1,_RPC_MESSAGE *param_2,int *param_3)
 
 {
-  OSF_CCALL *pOVar1;
+  OSF_CCALL *this_00;
+  uint *puVar1;
   int *piVar2;
-  uint uVar3;
-  void *pvVar4;
-  bool bVar5;
-  int iVar6;
-  long lVar7;
+  bool bVar3;
+  long lVar4;
+  int iVar5;
+  uint uVar6;
+  void *pvVar7;
   rpcconn_response *local_res10;
   
-  pOVar1 = this + 0x1d0;
-  bVar5 = false;
+  this_00 = this + 0x1d0;
+  bVar3 = false;
   local_res10 = param_1;
-  RtlEnterCriticalSection(pOVar1);
+  RtlEnterCriticalSection();
   if (*(int *)(this + 0x108) == 0xb) {
     if (*(longlong *)(this + 0x18) == 0) {
-      lVar7 = 0x6be;
+      lVar4 = 0x6be;
     }
     else {
-      lVar7 = *(long *)(this + 0x20);
+      lVar4 = *(long *)(this + 0x20);
     }
+    RtlLeaveCriticalSection(this_00);
   }
   else {
-    uVar3 = *(uint *)(param_2 + 0x18);
-    pvVar4 = *(void **)(param_2 + 0x10);
-    *(uint *)(this + 0x150) = *(int *)(this + 0x150) + uVar3;
-    iVar6 = PutOnQueue((QUEUE *)(this + 0x210),pvVar4,uVar3);
-    if (iVar6 == 0) {
+    uVar6 = *(uint *)(param_2 + 0x18);
+    puVar1 = (uint *)(this + 0x150);
+    pvVar7 = *(void **)(param_2 + 0x10);
+    lVar4 = UIntAdd(*puVar1,uVar6,puVar1);
+    if ((lVar4 < 0) || (iVar5 = PutOnQueue((QUEUE *)(this + 0x210),pvVar7,uVar6), iVar5 != 0)) {
+      CallFailed(this,0xe,0,0);
+      RtlLeaveCriticalSection(this_00);
+      lVar4 = 0xe;
+    }
+    else {
       if ((*(uint *)(param_2 + 0x48) & 0x1000) == 0) {
         if (*(void **)(this + 0x18) == (void *)0x0) {
           if ((3 < *(int *)(this + 0x21c)) && (param_3 != (int *)0x0)) {
             *(undefined4 *)(this + 0x1c4) = 1;
             *param_3 = 0;
           }
-          RtlLeaveCriticalSection(pOVar1);
+          RtlLeaveCriticalSection(this_00);
           SetEvent(*(undefined8 *)(this + 0x1a8));
         }
         else {
           if ((*(int *)(this + 0x108) != 0xb) || (*(int *)(this + 0x1cc) == 0)) {
-            uVar3 = *(uint *)(this + 0x1b4);
-            if ((uVar3 == 0) || (*(uint *)(this + 0x150) < uVar3)) {
+            uVar6 = *(uint *)(this + 0x1b4);
+            if ((uVar6 == 0) || (*puVar1 < uVar6)) {
               if (((((((byte)this[0x1c8] & 4) != 0) && (3 < *(int *)(this + 0x21c))) &&
                    (param_3 != (int *)0x0)) &&
-                  ((uVar3 <= *(uint *)(this + 0x150) &&
-                   (lVar7 = NdrCheckAsyncPipeStatus(*(void **)(this + 0x18),(long *)&local_res10),
-                   lVar7 == 0)))) && ((int)local_res10 == 2)) {
+                  ((uVar6 <= *puVar1 &&
+                   (lVar4 = NdrCheckAsyncPipeStatus(*(void **)(this + 0x18),(long *)&local_res10),
+                   lVar4 == 0)))) && ((int)local_res10 == 2)) {
                 *(undefined4 *)(this + 0x1c4) = 1;
                 *param_3 = 0;
               }
