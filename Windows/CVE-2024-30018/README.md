# CVE-2024-30018
[CVE-2023-30018](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-30018) is described as a Windows Kernel Elevation of Privilege Vulnerability

# Binarys
I diffed [KB5036980](https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/5FEDB4431047000/ntoskrnl.exe) & [KB5037771](https://msdl.microsoft.com/download/symbols/ntoskrnl.exe/8A3A5A161047000/ntoskrnl.exe) of Windows 11 23H2's ntoskrnl.exe binary to get these results. You can follow along and do the same, if you have the awesome [Ghidriff](https://clearbluejar.github.io/ghidriff/docs/ghidriff/) installed.
```
wget https://msdl.microsoft.com/download/symbols/ntkrnlmp.exe/8A3A5A161047000/ntkrnlmp.exe -O ntkrnlmp.exe.x64.10.0.22621.3593
wget https://msdl.microsoft.com/download/symbols/ntkrnlmp.exe/5FEDB4431047000/ntkrnlmp.exe -O ntkrnlmp.exe.x64.10.0.22621.3527
ghidriff ntkrnlmp.exe.x64.10.0.22621.3527 ntkrnlmp.exe.x64.10.0.22621.3593
```

# Overview
There were two changes in the binary, first, the removal of the symbol `Feature_Servicing_RSDTRelocation__private_IsEnabled`, which appears to be a servicing flag for ACPI [Root System Description Table](https://learn.microsoft.com/en-us/windows-hardware/drivers/bringup/acpi-system-description-tables#root-system-description-table-rsdt) relocation. The second change involves `NtSetInformationWorkerFactory`.  For a detailed write-up on worker factories, check out urien's post [Attacking Worker Factories](https://urien.gitbook.io/diago-lima/a-deep-dive-into-exploiting-windows-thread-pools/attacking-worker-factories). To paraphrase this blog, worker factories facilitate the creation and deletion of threads within a thread pool. 

Its likely the vulnerability lies in `NtSetInformationWorkerFactory` as that is directly accessible attack surface to user mode, as compared to the ACPI RSDT. 

The diff doesn't seem to raise any significant changes, as the controlflow remains largely unchanged.