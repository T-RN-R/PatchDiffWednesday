# CVE-2024-26209: Microsoft Local Security Authority Subsystem Service Information Disclosure Vulnerability
Mitchell T.

## The Basics
**Disclosure or Patch Date:** April 9, 2024
**Product:** Microsoft Windows
**Advisory:** [CVE-2024-26209](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-26209) 
**Binary**: `lsasrv.dll`

## The Vulnerability

**Bug class:** Information Disclosure
**Vulnerability details:**

**Patch analysis:**
 You can follow along by downloading the following two `lsasrv.dll` binaries:
 - Unpatched: [KB5035853](https://msdl.microsoft.com/download/symbols/lsasrv.dll/D405E2C1196000/lsasrv.dll)
 - Patched: [KB5036893](https://msdl.microsoft.com/download/symbols/lsasrv.dll/46E15EAD196000/lsasrv.dll)
Upon running the excellent [Ghidriff](https://clearbluejar.github.io/ghidriff/docs/ghidriff/) against these two binaries, I immediately can see two things, 1) the addition of a feature flag: `Feature_685114687` & 2) changes to `NegEnumPackagePrefixesCall`.  This indicates to me that whatever changes the developer made to this code, Microsoft is not confident that it it will maintain app-compat. Therefore, they gate the change behind a feature flag for telemetry, to determine if there are any breaking changes across all patched machines. 

Armed with this new knowledge, we can quickly spot the patch:
```diff
```diff
+    bVar6 = wil::details::FeatureImpl<struct___WilFeatureTraits_Feature_685114687>::
+            __private_IsEnabled(&`private:_static_class_wil::details::FeatureImpl<struct___WilFeatureTraits_Feature_685114687>&___ptr64___cdecl_wil::Feature<struct___WilFeatureTraits_Feature_685114687>::GetImpl(void)'
+                                 ::`2'::impl);
+    if (bVar6) {
+      *(undefined8 *)(puVar14 + -8) = 0x180087427;
+      memset(puVar9,0,uVar12);
+    }

```

It looks like an open and shut case of uninitialized data making its way back to the caller. The patch resolves this by explicitly nulling out `puVar9` with `memset`. `NegEnumPackagePrefixesCall` is invoked as part of `SPNEGO`, early on in the negotiation stages of an authentication flow. This means this could likely leak sensitive data, including pointers, over the wire.


**Thoughts on how this vuln might have been found _(fuzzing, code auditing, variant analysis, etc.)_:** Likely manual audit, or a happy accident.

